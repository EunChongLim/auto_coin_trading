# 비트코인 자동매매 프로젝트 Cursor AI 규칙

## 프로젝트 개요
- Python 기반 비트코인 자동매매 시스템
- Upbit API를 사용한 1초봉 데이터 기반 스캘핑 전략
- backtest.py로 검증 후 main.py에 적용

## 핵심 규칙

### 1. 절대 변경 금지 항목
- `window_size = 3600` (슬라이딩 윈도우 크기)
- 1초봉 데이터 사용 (1분봉 제외)
- Upbit API 호출 시 항상 `+09:00` timezone 포함

### 2. 파라미터 수정 시
- 반드시 backtest.py와 main.py 동시 수정
- 수정 전 기존 백테스팅 결과 기록
- 수정 후 랜덤 3일 백테스팅으로 검증
- 결과 나쁘면 즉시 되돌리기

### 3. 검증된 실패 사례 (절대 제안 금지)
- ❌ 변동성 적응형 손익 (-4.43% 손실)
- ❌ 윈도우 크기 200개 (실거래 손실)
- ❌ Timezone 누락 (과거 데이터 조회 실패)
- ❌ `to_param`에서 1초 빼기 (gap 발생)

### 4. Upbit API 제한사항
```python
# ✅ 올바른 방법
to_param = to_date.strftime("%Y-%m-%dT%H:%M:%S+09:00")  # Timezone 필수
to_param = data[-1]['candle_date_time_kst'] + "+09:00"  # Gap 방지

# ❌ 금지
to_param = to_date.strftime("%Y-%m-%dT%H:%M:%S")  # Timezone 없음
to_param = (oldest_time - pd.Timedelta(seconds=1))  # 1초 빼기
```

### 5. 코드 스타일
- 항상 한글로 응답
- 변경 이유를 명확히 설명
- 백테스팅 결과를 수치로 제시
- 과적합 방지를 최우선으로 고려

### 6. 파일 구조
- `main.py`: 실시간 거래 (1초봉 3600개 슬라이딩 윈도우)
- `backtest.py`: 과거 데이터 백테스팅 (랜덤 3일)
- `PROJECT_RULES.md`: 상세 규칙 문서

### 7. 현재 최적 설정 (v3.1 BTC)
```python
# 매수 조건
RSI: 30 < rsi < 60
거래량: volume > volume_ma × 1.1
RSI 상승, 가격 > MA Fast, 양봉

# 손익
손절: -1.5%
익절: +0.8%
RSI 매도: rsi > 80 AND profit > 0.5%
```

### 8. 디버깅 우선순위
1. Timezone 확인 (`+09:00`)
2. `to_param` 로직 (1초 더하기)
3. 중복 제거 (`drop_duplicates`)
4. window_size 일치 (main.py ≡ backtest.py)

### 9. 제안 시 주의사항
- 복잡한 알고리즘보다 단순한 고정 규칙 선호
- 과거 데이터 맞추기(과적합) 경계
- 백테스팅 없는 변경 절대 금지
- "시도해볼까요?" 보다 "백테스팅 결과 확인 후 결정" 권장

### 10. 성과 기록 참조
- v3.0 (RSI 35~55, 거래량 1.05배): -0.60%
- v3.1 변동성 적응형: -4.43% (실패)
- v3.1 BTC 최적화: 테스트 중

## 중요: 사용자가 "안된다"고 판단하지 말 것
- API 문제 발생 시 사용자 코드를 먼저 의심
- "불가능"하다고 결론짓기 전에 모든 가능성 탐색
- Timezone, to_param 로직 등 세부사항 재확인

